<!DOCTYPE html>
<html lang="de" class="bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subnetz-Rechner</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Optional: Für eine schönere Darstellung des JSON-Outputs */
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body class="font-sans text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-2xl">

        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Subnetz-Rechner</h1>
            <p class="text-gray-600 mt-2">Geben Sie eine IP-Adresse im CIDR-Format ein (z.B. 192.168.1.1/24)</p>
        </header>

        <main class="bg-white rounded-lg shadow-md p-6">
            
            <!-- Eingabebereich -->
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <div class="w-full">
                    <label for="ipAddress" class="sr-only">IP-Adresse mit CIDR</label>
                    <input type="text" id="ipAddress" placeholder="192.168.1.1/24"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                </div>
                
                <div class="flex gap-2 w-full sm:w-auto">
                    <button onclick="calculate()"
                            class="w-full sm:w-auto bg-blue-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200">
                        Berechnen
                    </button>
                    <button id="saveButton"
                            class="w-full sm:w-auto bg-gray-600 text-white font-semibold py-2 px-6 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200">
                        Speichern
                    </button>
                </div>
            </div>

            <!-- Ergebnisbereich -->
            <div id="resultsWrapper" class="mt-8">
                <h2 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Ergebnisse</h2>
                <div id="results" class="bg-gray-50 p-4 rounded-md text-gray-700">
                    <pre>Die berechneten Daten werden hier angezeigt.</pre>
                </div>
            </div>

        </main>

    </div>

    <script>
        function ipToLong(ip){
            return ip.split('.').reduce((acc, octet) => (acc << 8) + parseInt(octet, 10), 0) >>> 0;
        }

        function longToIp(long){
            return[
                (long >>> 24) & 255,
                (long >>> 16) & 255,
                (long >>> 8) & 255,
                long & 255
            ].join('.');
        }

        function calculateSubnet(ipCidr){
            try{
                if (!ipCidr || ipCidr.trim() === '') {
                    throw new Error("Bitte geben Sie eine IP-Adresse mit CIDR-Notation ein.");
                }

                const [ip, cidrStr] = ipCidr.split('/');

                if(!cidrStr || cidrStr.trim() === ''){
                    throw new Error("CIDR-Notation fehlt (z.B. /24).");
                }
                if(!/^((\d{1,3}\.){3}\d{1,3})$/.test(ip) || ip.split('.').some(octet => parseInt(octet) > 255)) {
                    throw new Error("Ungültige IP-Adresse.");
                }
                if(ip.split('.').length !== 4){
                    throw new Error("IP-Adresse muss vier Oktette enthalten.");
                }

                const cidr = parseInt(cidrStr, 10);
                if(isNaN(cidr) || cidr < 0 || cidr > 32){
                    throw new Error("Ungültige CIDR-Notation. Muss zwischen 0 und 32 liegen.");
                }

                const ipLong = ipToLong(ip);
                const subnetMaskLong = (0xFFFFFFFF << (32 - cidr)) >>> 0;
                const networkAddressLong = (ipLong & subnetMaskLong) >>> 0;
                const broadcastAddressLong = (networkAddressLong | ~subnetMaskLong) >>> 0;
                
                const firstHostLong = networkAddressLong + 1;
                const lastHostLong = broadcastAddressLong - 1;

                const totalHosts = Math.pow(2, 32 - cidr);
                const usableHosts = totalHosts >= 2 ? totalHosts - 2 : 0;
                
                const hostRange = usableHosts > 0 ? `${longToIp(firstHostLong)} - ${longToIp(lastHostLong)}` : 'N/A';

                return{
                    "IP-Adresse": ip,
                    "Subnetzmaske": longToIp(subnetMaskLong),
                    "Netzwerkadresse": longToIp(networkAddressLong),
                    "Broadcast-Adresse": longToIp(broadcastAddressLong),
                    "Host-Bereich": hostRange,
                    "Gesamte Hosts": totalHosts,
                    "Nutzbare Hosts": usableHosts
                };
            } 
            catch(error){
                return { error: error.message };
            }
        }

        function calculate(){
            const ipCidr = document.getElementById('ipAddress').value;
            const results = calculateSubnet(ipCidr);
            const resultsDiv = document.getElementById('results');
            
            // Verwenden Sie <pre> für eine formatierte Ausgabe
            const pre = document.createElement('pre');
            
            if(results.error){
                pre.textContent = `Fehler: ${results.error}`;
                pre.className = 'text-red-600 font-semibold';
            } 
            else{
                pre.textContent = JSON.stringify(results, null, 2);
            }
            resultsDiv.innerHTML = ''; // Vorherige Ergebnisse löschen
            resultsDiv.appendChild(pre);
        }

        document.getElementById('saveButton').addEventListener('click', function(){
            const ipCidr = document.getElementById('ipAddress').value; 
            const results = calculateSubnet(ipCidr);

            if(results.error){
                alert(`Daten konnten aufgrund eines Fehlers nicht gespeichert werden: ${results.error}`);
                console.error("Fehler beim Speichern der Subnetzdaten:", results.error);
            } 
            else{
                localStorage.setItem('lastSubnetCalculation', JSON.stringify(results));
                alert('Subnetzdaten erfolgreich gespeichert!');
            }
        });
    </script>

</body>
</html>